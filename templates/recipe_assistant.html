<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe AI Assistant</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@400;700&display=swap" rel="stylesheet">
</head>
<body style="background-color: #71797E;">
    <div class="container mt-5">
        <div class="header-container text-center">
            <div id="header-content" class="header-content">
                <h1 id="title-text">Recipe AI Assistant</h1>
                <div id="robot-container">
                    <img id="jumping-bowl" style="max-width: 70px;" src="../static/jumping_food_bowl.gif" alt="Animated GIF">
                </div>
            </div>
        </div>        
        <form id="recipe-form" class="text-center mt-4">
            <div class="form-group d-flex flex-column flex-sm-row justify-content-center">
                <input type="text" id="recipe-input" name="name" class="form-control" placeholder="Enter desired recipe">
                <select id="recipe-type" class="form-control" name="type">
                    <option disabled selected value="">Select a type (i.e. Vegan)</option>
                    <option value="all">All</option>
                    <option value="vegan">Vegan</option>
                    <option value="vegetarian">Vegetarian</option>
                    <option value="non-vegetarian">Non-Vegetarian</option>
                </select>
                <button type="button" id="start-record-btn" class="btn btn-primary ml-2">ðŸŽ¤</button>
                <button type="submit" class="btn btn-primary ml-2" id="getRecBtn">Get Recipe</button>
            </div>
        </form>
        <div id="recipe-result" class="mt-4 d-none"></div>
    </div>

    <script src="../static/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@latest/dist/umd/supabase.js"></script>
    <script>
// Import Supabase client if using ES modules
import { createClient } from '@supabase/supabase-js';

// Initialize Supabase client
const supabaseUrl = 'https://alkeobrltwcjdvptiddy.supabase.co';
const supabaseKey = 'your-supabase-key'; // Ensure this key is not exposed publicly
const supabase = createClient(supabaseUrl, supabaseKey);

// Function to register a new user
async function registerUser(username, password, email) {
    console.log('Attempting to register user:', { username, email }); // Debugging statement
    const { data, error } = await supabase
        .from('accounts') // Ensure 'accounts' is the correct table name
        .insert([{ username, password, email }]);

    if (error) {
        console.error('Error registering user:', error.message);
        alert(`Error registering user: ${error.message}`);
    } else {
        console.log('User registered successfully:', data); // Check if data contains the new user info
        alert('Registration successful!');

        // Optional login logic
        const { user, error: loginError } = await supabase.auth.signIn({ email, password });
        if (loginError) {
            console.error('Login failed:', loginError.message);
            alert(`Login failed: ${loginError.message}`);
        } else {
            console.log('User logged in:', user);
            // Uncomment if you want to redirect after login
            // window.location.href = 'recipe_assistant.html';
        }
    }
}

// Event listener for the registration form submission
document.addEventListener('DOMContentLoaded', () => {
    const registrationForm = document.getElementById('registration-form');
    
    registrationForm.addEventListener('submit', async (event) => {
        event.preventDefault(); // Prevent default form submission

        // Get user inputs
        const username = document.getElementById('username').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        // Call registerUser to save the new user
        await registerUser(username, password, email);
    });
});


    </script>
</body>
</html>
